<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SMS-Mail Hub</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="app">

    <!-- Login/Signup -->
    <section id="auth-section" class="section active">
      <h1>Welcome to SMS-Mail Hub</h1>
      <div class="tabs">
        <button id="login-tab" class="tab active">Login</button>
        <button id="signup-tab" class="tab">Signup</button>
      </div>
      <form id="auth-form">
        <input type="email" id="email" placeholder="Email" required />
        <input type="password" id="password" placeholder="Password" required minlength="6" />
        <button type="submit" id="auth-submit">Login</button>
      </form>
    </section>

    <!-- Dashboard -->
    <section id="dashboard-section" class="section">
      <h1>Dashboard</h1>
      <button id="generate-temp-email">Generate TempMail</button>
      <button id="generate-temp-number">Generate TempNumber</button>
      <button id="go-to-inbox">Go to Inbox</button>

      <div id="generated-email" class="output"></div>
      <div id="generated-number" class="output"></div>
    </section>

    <!-- Inbox -->
    <section id="inbox-section" class="section">
      <h1>Inbox</h1>
      <button id="back-to-dashboard">Back to Dashboard</button>
      <div id="mailbox-list"></div>
      <div id="sms-inbox-list"></div>
    </section>

  </div>

<script>
  // Simple section routing
  const authSection = document.getElementById('auth-section');
  const dashboardSection = document.getElementById('dashboard-section');
  const inboxSection = document.getElementById('inbox-section');

  const loginTab = document.getElementById('login-tab');
  const signupTab = document.getElementById('signup-tab');
  const authForm = document.getElementById('auth-form');
  const authSubmit = document.getElementById('auth-submit');

  let loggedIn = false;
  let tempEmail = '';
  let tempNumber = '';

  // Switch tabs login/signup
  loginTab.onclick = () => {
    loginTab.classList.add('active');
    signupTab.classList.remove('active');
    authSubmit.textContent = 'Login';
  };
  signupTab.onclick = () => {
    signupTab.classList.add('active');
    loginTab.classList.remove('active');
    authSubmit.textContent = 'Signup';
  };

  // Form submit dummy login/signup
  authForm.onsubmit = (e) => {
    e.preventDefault();
    // In real app, do backend login/signup
    loggedIn = true;
    authSection.classList.remove('active');
    dashboardSection.classList.add('active');
  };

  // Generate TempMail
  document.getElementById('generate-temp-email').onclick = async () => {
    const res = await fetch('/api/generate-email');
    const data = await res.json();
    tempEmail = data.email;
    document.getElementById('generated-email').textContent = `TempMail: ${tempEmail}`;
  };

  // Generate TempNumber - placeholder (you can extend backend API)
  document.getElementById('generate-temp-number').onclick = async () => {
    // For demo: just generate random number string
    tempNumber = '+1' + Math.floor(1000000000 + Math.random() * 9000000000);
    document.getElementById('generated-number').textContent = `TempNumber: ${tempNumber}`;
  };

  // Go to Inbox
  document.getElementById('go-to-inbox').onclick = () => {
    if (!tempEmail) return alert('Generate a TempMail first!');
    dashboardSection.classList.remove('active');
    inboxSection.classList.add('active');
    loadInbox();
  };

  // Back to Dashboard
  document.getElementById('back-to-dashboard').onclick = () => {
    inboxSection.classList.remove('active');
    dashboardSection.classList.add('active');
  };

  // Load mailbox from 1secmail
  async function loadInbox() {
    const [login, domain] = tempEmail.split('@');
    const mailboxList = document.getElementById('mailbox-list');
    mailboxList.innerHTML = 'Loading mails...';

    try {
      const res = await fetch(`/api/mailbox?login=${login}&domain=${domain}`);
      const messages = await res.json();

      if (messages.length === 0) {
        mailboxList.innerHTML = '<p>No emails found.</p>';
        return;
      }

      mailboxList.innerHTML = messages
        .map(msg => `<div class="mail-item" data-id="${msg.id}"><b>${msg.from}</b> - ${msg.subject}</div>`)
        .join('');

      // Add click event to each mail to load content
      document.querySelectorAll('.mail-item').forEach(el => {
        el.onclick = async () => {
          const id = el.getAttribute('data-id');
          const msgRes = await fetch(`/api/mailbox/message?login=${login}&domain=${domain}&id=${id}`);
          const msgData = await msgRes.json();
          alert(`From: ${msgData.from}\nSubject: ${msgData.subject}\n\n${msgData.textBody || msgData.htmlBody}`);
        };
      });
    } catch (e) {
      mailboxList.innerHTML = '<p>Error loading mailbox.</p>';
    }
  }
</script>
</body>
          </html
